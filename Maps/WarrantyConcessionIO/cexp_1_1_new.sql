SELECT
		/*+ NO_CPU_COSTING */
		'TRANE_MATERIAL' AS TYPE,
		MLR.CLAIM_NBR,
		MLR.RETRO_ID,
		'CONCESSION' AS CLAIM_TYPE,
		'TRANE COMPANY' AS EXPENSE_TYPE_DESCR,
		'MATERIAL' AS EXPENSE_TYPE_CATG,
		LR.CHARGE_COMM_PCT,
		LR.CHARGE_COMPANY_PCT,
		MAX(((LR.APPR_SUBLET_MAT_AMT + LR.APPR_SUBLET_REF_AMT + LR.APPR_SUBLET_SERV_AMT) /
		(
			SELECT COUNT(DISTINCT LRS.STEP_NBR) FROM WC_LABOR_ROLLUP LRS WHERE LRS.CLAIM_NBR = LR.CLAIM_NBR
		)
		* LR.CHARGE_COMPANY_PCT)) AS DOLLAR_AMOUNT,
		MLR.STEP_NBR
		/* DATES FROM DAY_TIME TABLE */
		,
		MLR.CCN_TRX_DATE_KEY,
		MLR.ORIGINAL_SHIP_DATE_KEY,
		MLR.FAIL_DATE_KEY,
		MLR.START_DATE_KEY,
		MLR.GL_ACCOUNT_SCD_KEY
		/* GL_ACCOUNT_SCD.GL_ACCOUNT_SCD_KEY */
		,
		MLR.PROD_CODE_SCD_KEY
		/* PROD_CODE_SCD.PROD_CODE_SCD_KEY */
		,
		MLR.CUST_ACCOUNT_SCD_KEY
		/* CUST_ACCOUNT_SCD.CUST_ACCOUNT_SCD_KEY */
		,
		MLR.SUBMIT_OFFICE_SCD_KEY
		/* SUBMIT_OFFICE_SCD.SUBMIT_OFFICE_SCD_KEY */
		,
		MLR.TRX_CURRENCY
		-- added
/*
		,MLR.CCN_TRX_DATE_KEY
		,min(TD.FULL_DATE) trxMin
		,max(TD.FULL_DATE) trxMax
		,min(TDF.FULL_DATE) failMin
		,max(TDF.FULL_DATE) failMax
*/
	FROM
		WC_MAT_LBR_ROLLUP MLR
	INNER JOIN WC_LABOR_ROLLUP LR ON MLR.DETAIL_NBR = LR.DETAIL_NBR AND MLR.CLAIM_NBR = LR.CLAIM_NBR AND MLR.STEP_NBR = LR.STEP_NBR
	INNER JOIN TIME_DAY TD        ON TD.TIME_KEY = MLR.CCN_TRX_DATE_KEY
	INNER JOIN TIME_DAY TDF        ON TDF.TIME_KEY = MLR.FAIL_DATE_KEY
		-- EXPENSE_TYPE_SCD ET,
		-- CLAIM_TYPE_SCD CT,
	INNER JOIN R12_GL_ACCOUNT_SCD GLA -- -SS-
	ON GLA.GL_ACCOUNT_SCD_KEY = MLR.GL_ACCOUNT_SCD_KEY
		-- -SS- NEW
	INNER JOIN R12_ACCOUNT_FILTER_UPD AFU ON AFU.R12_ACCOUNT = GLA.R12_ACCOUNT
		-- -SS- NEW
	WHERE
		/* CONCESSION CLAIM TYPE ONLY */
		MLR.CLAIM_TYPE_SCD_KEY = 11
		--AND TD.FULL_DATE>=TO_DATE('1/1/2006','MM/DD/YYYY')  and TD.FULL_DATE < TO_DATE('6/1/2007','MM/DD/YYYY')
		AND TD.FULL_DATE >= TO_DATE('1/1/2001', 'MM/DD/YYYY')
		-- -SS- AND MLR.DETAIL_NBR = LR.DETAIL_NBR
		-- -SS- AND MLR.CLAIM_NBR = LR.CLAIM_NBR
		-- -SS- AND MLR.STEP_NBR = LR.STEP_NBR
		/* COMMETED OUT PER PAT'S MEETING 6/7/07
		AND MLR.EXPENSE_TYPE_SCD_KEY = LR.EXPENSE_TYPE_SCD_KEY
		AND MLR.EXPENSE_TYPE_SCD_KEY = ET.EXPENSE_TYPE_SCD_KEY
		*/
		--AND MLR.CLAIM_TYPE_SCD_KEY = CT.CLAIM_TYPE_SCD_KEY
		--AND CT.CLAIM_TYPE_CODE ='CONCESSION'
		-- -SS- NEW
		AND (AFU.EQUAL_710000 = 'Y'	OR AFU.EQUAL_806300 = 'Y')
		-- -SS- NEW
		-- -SS- AND GLA.ACCOUNT IN('710000', '806300')
		--                 AND MLR.CLAIM_NBR IN ('8705840',
		--                                       '8667362',
		--                                       '8728663',
		--                                       '8707634',
		--                                       '8727943',
		--                                       '8618275')
		AND TD.YEAR = 2016
		AND TD.MONTH = 10
		and mlr.claim_nbr in ('9070848','9100994','9133308','9158008','9185210','9200355','9223441','9230190','9235713',
					'9235713','9247944','9300589','9309873','9309873','9323301','9323301','9337832','9337832','9337832','9337832',
					'9340100','9340100','9382451','9383293','9385451','9385452','9385453','9387128','9387991','9387991','9390344',
					'9390344','9390344','9390344','9394521','9398203','9398711','9399821','9402149','9402149','9404113','9404113')
	GROUP BY
		MLR.CLAIM_NBR--, CT.CLAIM_TYPE_CODE
		,
		LR.CHARGE_COMM_PCT,
		LR.CHARGE_COMPANY_PCT,
		MLR.CCN_TRX_DATE_KEY,
		MLR.ORIGINAL_SHIP_DATE_KEY,
		MLR.FAIL_DATE_KEY,
		MLR.START_DATE_KEY,
		MLR.STEP_NBR,
		MLR.GL_ACCOUNT_SCD_KEY,
		MLR.PROD_CODE_SCD_KEY,
		MLR.CUST_ACCOUNT_SCD_KEY,
		MLR.SUBMIT_OFFICE_SCD_KEY,
		MLR.TRX_CURRENCY,
		MLR.RETRO_ID
;