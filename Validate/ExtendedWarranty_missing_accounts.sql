DESC DM_030_EXT_SALES_MVW;
SELECT
		TO_CHAR(A.JOURNAL_DATE, 'YYYYMM') AS JRNL_YEAR_MONTH,
		A.R12_ACCOUNT AS GL_ACCOUNT,
		CASE        WHEN A.R12_ENTITY IN('5773', '5588')
			THEN 'CAD' WHEN A.R12_ENTITY IN('5575', '5612', '5743', '9256', '9258', '9298', '9299', '9984')
			THEN 'USD'
			ELSE '???'
		END AS COUNTRY_INDICATOR,
		TRUNC(A.JOURNAL_DATE, 'MM') AS JOURNAL_DATE,
		SUM(A.MONETARY_AMOUNT * - 1) AS REVENUE_AMOUNT,
		AFU.LIKE_5268,
		AFU.LIKE_52_53_54,
		AFU.LIKE_52_53_54_NOT_5268
	FROM
		R12_BI_ACCT_ENTRY_STG A
	INNER JOIN R12_TRNBI_BI_HDR_STG B     ON A.INVOICE = B.INVOICE AND A.CUSTOMER_TRX_ID = B.CUSTOMER_TRX_ID
	INNER JOIN R12_BI_HDR_STG C           ON B.INVOICE = C.INVOICE AND B.CUSTOMER_TRX_ID = C.CUSTOMER_TRX_ID --  AND C.ENTRY_TYPE = 'IN'
	INNER JOIN R12_ACCOUNT_FILTER_UPD AFU ON AFU.R12_ACCOUNT = A.R12_ACCOUNT
	WHERE
		A.JOURNAL_DATE BETWEEN TO_DATE('01/01/2004', 'MM/DD/YYYY') AND LAST_DAY(ADD_MONTHS(SYSDATE, - 1))
		--  AND A.R12_ENTITY IN('5773', '5588', '5575', '5612', '5743', '9256', '9258', '9298', '9299', '9984') -- -SS- CAN, USA
		--  AND AFU.LIKE_5268 = 'Y'
		AND AFU.LIKE_52_53_54_NOT_5268 = 'Y'
		AND A.R12_ACCOUNT IN('282106', '282151')
	GROUP BY
		TO_CHAR(A.JOURNAL_DATE, 'YYYYMM'),
		A.R12_ACCOUNT,
		CASE        WHEN A.R12_ENTITY IN('5773', '5588')
			THEN 'CAD' WHEN A.R12_ENTITY IN('5575', '5612', '5743', '9256', '9258', '9298', '9299', '9984')
			THEN 'USD'
			ELSE '???'
		END,
		TRUNC(A.JOURNAL_DATE, 'MM'),
		AFU.LIKE_5268,
		AFU.LIKE_52_53_54,
		AFU.LIKE_52_53_54_NOT_5268
	ORDER BY
		JRNL_YEAR_MONTH;
SELECT
		*
	FROM
		DM_030_EXT_SALES_MVW
	WHERE
		0 = 0
		and gl_account in ('282106','282151')
		AND JOURNAL_DATE > '30-sep-16' 
		order by gl_account, journal_date;
/*
282114 526880
282115 526881
282116 526882
282117 526883
282118 526884
282119 526885
282120 526886
282121 526887
282122 526888
282123 526889
282124 526890
282125 526891
282126 526892
282127 526893
282128 526895
*/
SELECT DISTINCT
		R12_ACCOUNT
	FROM
		DBO.R12_ACCOUNT_FILTER_UPD
	WHERE
		LIKE_5268 = 'Y'
	ORDER BY
		1;
SELECT DISTINCT
		RPS.R12_ACCOUNT,
		RPS.R12_ACCOUNT_DESCR,
		RPS.PS_ACCOUNT,
		RPS.PS_ACCOUNT_DESCR,
		OPS.TRANE_ACCOUNT_IND
		/*
		, afu.r12_account
		,Afu.Like_5268
		,ops.trane_account_ind
		, case when ps_account like '5268%' then 'XXX' else ' ' end
		*/
	FROM
		OTR_TRANE_ACCOUNTS_PS OPS
	INNER JOIN DBO.R12_TRANE_ACCOUNTS_PS RPS       ON RPS.PS_ACCOUNT = OPS.ACCOUNT
	LEFT OUTER JOIN DBO.R12_ACCOUNT_FILTER_UPD AFU ON AFU.R12_ACCOUNT = RPS.R12_ACCOUNT
	WHERE
		0 = 0
		-- and ops.account like '5268%'
		-- and ops.trane_account_ind = 'X'
		-- AND RPS.R12_ACCOUNT IN('282106', '282151')
		AND RPS.R12_ACCOUNT IN('511101', '655711', '411101', '665911', '132204', '650301', '685611', '411301', '281720', '132305', '210105', '281719')
	ORDER BY
		1;
SELECT
		TO_CHAR(A.JOURNAL_DATE, 'YYYYMM') AS JRNL_YEAR_MONTH,
		A.R12_ACCOUNT AS GL_ACCOUNT,
		CASE        WHEN A.R12_ENTITY IN('5773', '5588')
			THEN 'CAD' WHEN A.R12_ENTITY IN('5575', '5612', '5743', '9256', '9258', '9298', '9299', '9984')
			THEN 'USD'
			ELSE '???'
		END AS COUNTRY_INDICATOR,
		TRUNC(A.JOURNAL_DATE, 'MM') AS JOURNAL_DATE,
		SUM(A.MONETARY_AMOUNT * - 1) AS REVENUE_AMOUNT,
		C.ENTRY_TYPE
	FROM
		R12_BI_ACCT_ENTRY_STG A
	INNER JOIN R12_TRNBI_BI_HDR_STG B     ON A.INVOICE = B.INVOICE AND A.CUSTOMER_TRX_ID = B.CUSTOMER_TRX_ID
	INNER JOIN R12_BI_HDR_STG C           ON B.INVOICE = C.INVOICE AND B.CUSTOMER_TRX_ID = C.CUSTOMER_TRX_ID AND C.ENTRY_TYPE = 'INV'
	INNER JOIN R12_ACCOUNT_FILTER_UPD AFU ON AFU.R12_ACCOUNT = A.R12_ACCOUNT
	WHERE
		0 = 0
		--   and  A.JOURNAL_DATE BETWEEN TO_DATE('01/01/2003', 'MM/DD/YYYY') AND LAST_DAY(ADD_MONTHS(SYSDATE, - 1))
		--  AND A.R12_ENTITY IN('5773', '5588', '5575', '5612', '5743', '9256', '9258', '9298', '9299', '9984') -- -SS- CAN, USA
		AND AFU.LIKE_5 = 'Y'
		AND AFU.R12_ACCOUNT IN('282106', '282151')
	GROUP BY
		TO_CHAR(A.JOURNAL_DATE, 'YYYYMM'),
		A.R12_ACCOUNT,
		C.ENTRY_TYPE,
		CASE        WHEN A.R12_ENTITY IN('5773', '5588')
			THEN 'CAD' WHEN A.R12_ENTITY IN('5575', '5612', '5743', '9256', '9258', '9298', '9299', '9984')
			THEN 'USD'
			ELSE '???'
		END,
		TRUNC(A.JOURNAL_DATE, 'MM')
	ORDER BY
		GL_ACCOUNT,
		JRNL_YEAR_MONTH;
SELECT * FROM R12_BI_ACCT_ENTRY_STG WHERE R12_ACCOUNT IN('282106', '282151') ;
SELECT
		CASE WHEN A.R12_ENTITY IN('5773', '5588')
			THEN 'CAN'
			ELSE 'USA'
		END AS COUNTRY_INDICATOR,
		A.R12_ACCOUNT AS ACCOUNT,
		AFU.DESCR,
		A.MONETARY_AMOUNT * - 1 AS REVENUE_AMOUNT,
		A.Journal_Date		
	FROM
		R12_BI_ACCT_ENTRY_STG A
	INNER JOIN R12_TRNBI_BI_HDR_STG B     ON A.INVOICE = B.INVOICE AND A.CUSTOMER_TRX_ID = B.CUSTOMER_TRX_ID
	INNER JOIN R12_BI_HDR_STG C           ON B.INVOICE = C.INVOICE AND B.CUSTOMER_TRX_ID = C.CUSTOMER_TRX_ID
	INNER JOIN R12_ACCOUNT_FILTER_UPD AFU ON AFU.R12_ACCOUNT = A.R12_ACCOUNT
	WHERE 0=0
		-- and A.JOURNAL_DATE >=(TO_DATE('1-' || :RUNDATE, 'dd-mon-yy'))
		-- AND A.JOURNAL_DATE <=(LAST_DAY(TO_DATE('1-' || :RUNDATE, 'dd-mon-yy')))
		AND C.ENTRY_TYPE = 'INV'
		AND A.R12_ENTITY IN('5773', '5588')
		-- AND AFU.LIKE_5 = 'Y'
		AND A.R12_ACCOUNT IN('282106', '282151')
;

/*EW Seasonalized Revenue Release Report 13-63 Months qry*/
select a.*,
a.rec_rev_mnthly +0.000004 as Total_Recognized_Rev,
a.DEFERRED_REVENUE +0.000004 AS Deferred_Revenues,
a.SHORT_TERM_DR +0.000004 as short_term,
a.LONG_TERM_DR +0.000004 as Long_term,
a.REC_REV_PRE_MNTHLY +0.000004 as PreviousTotal_RR,
a.REC_REV_FOR_PERIOD +0.000004 as Recognized_Revenue_Period,
A.FORECAST_YR_TOTAL +0.000004 as Total_Year,
A.REV_RELEASE_TOTAL +0.000004  AS Recognized_Revenue
from DM_030_REV_RELEASE a
where a.country_indicator  IN ('USA','CAN')
AND a.RUN_PERIOD >= to_date('1-'||:RunDate,'dd-mon-yy')
and  a.RUN_PERIOD<add_months(to_date('1-'||:RunDate,'dd-mon-yy'),1) 
AND  a.report_type = '13-63'
order by ship_period;