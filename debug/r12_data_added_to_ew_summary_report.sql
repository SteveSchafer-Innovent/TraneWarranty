SELECT
		SUM(A.MONETARY_AMOUNT),
		A.R12_ACCOUNT AS ACCOUNT,
		AFU.DESCR AS ACCOUNT_DESC,
		CASE WHEN A.R12_ENTITY IN('5773', '5588')
			THEN 'CAN'
			ELSE 'USA'
		END AS COUNTRY_INDICATOR,
		c.entry_type,
		C.Bill_Source_Id

	FROM
		R12_BI_ACCT_ENTRY_STG A
	INNER JOIN R12_TRNBI_BI_HDR_STG B     ON A.INVOICE = B.INVOICE AND A.CUSTOMER_TRX_ID = B.CUSTOMER_TRX_ID
	INNER JOIN R12_BI_HDR_STG C           ON B.INVOICE = C.INVOICE AND B.CUSTOMER_TRX_ID = C.CUSTOMER_TRX_ID
	INNER JOIN R12_ACCOUNT_FILTER_UPD AFU ON AFU.R12_ACCOUNT = A.R12_ACCOUNT
	WHERE
		A.JOURNAL_DATE >= TO_DATE('1-'||:RUNDATE, 'dd-mon-yy')
		AND JOURNAL_DATE <= LAST_DAY(TO_DATE('1-'||:RUNDATE, 'dd-mon-yy'))
		-- AND A.BUSINESS_UNIT IN('BIUSA', 'BICAN', 'BIUSC')
		AND A.R12_ENTITY IN('5773', '5588', '5575', '5612', '5743', '9256', '9258', '9298', '9299', '9984')
		AND AFU.LIKE_5 = 'Y'
		AND A.R12_LOCATION IN('113602', '115615', '129003')
		AND
		CASE        WHEN A.CURRENCY_CD = 'USD'
			THEN 'USA' WHEN A.CURRENCY_CD = 'CAD'
			THEN 'CAN'
		END = UPPER(:COUNTRY)
		AND C.ENTRY_TYPE in ('CM','INV')
--		AND CLAIM_NUMBER LIKE 'C%'
		and afu.r12_account = 282151
	GROUP BY
		A.R12_ACCOUNT,
		AFU.DESCR,
		A.R12_ENTITY,
		c.entry_type,
		C.Bill_Source_Id
	ORDER BY
		ACCOUNT;
		
SELECT
		A.MONETARY_AMOUNT,
		A.R12_ACCOUNT AS ACCOUNT,
		A.INVOICE,
		A.CUSTOMER_TRX_ID,
--		AFU.DESCR AS ACCOUNT_DESC,
		CASE WHEN A.R12_ENTITY IN('5773', '5588')
			THEN 'CAN'
			ELSE 'USA'
		END AS COUNTRY_INDICATOR,
		c.*
	FROM
		R12_BI_ACCT_ENTRY_STG A
--	INNER JOIN R12_TRNBI_BI_HDR_STG B     ON A.INVOICE = B.INVOICE AND A.CUSTOMER_TRX_ID = B.CUSTOMER_TRX_ID
	INNER JOIN R12_BI_HDR_STG C           ON A.INVOICE = C.INVOICE AND A.CUSTOMER_TRX_ID = C.CUSTOMER_TRX_ID
--	INNER JOIN R12_ACCOUNT_FILTER_UPD AFU ON AFU.R12_ACCOUNT = A.R12_ACCOUNT
	WHERE
		A.JOURNAL_DATE >= TO_DATE('1-'||:RUNDATE, 'dd-mon-yy')
		AND JOURNAL_DATE <= LAST_DAY(TO_DATE('1-'||:RUNDATE, 'dd-mon-yy'))
		-- AND A.BUSINESS_UNIT IN('BIUSA', 'BICAN', 'BIUSC')
		AND A.R12_ENTITY IN('5773', '5588', '5575', '5612', '5743', '9256', '9258', '9298', '9299', '9984')
		--AND AFU.LIKE_5 = 'Y'
		and a.r12_account = 282105
		AND A.R12_LOCATION IN('113602', '115615', '129003')
		AND
		CASE        WHEN A.CURRENCY_CD = 'USD'
			THEN 'USA' WHEN A.CURRENCY_CD = 'CAD'
			THEN 'CAN'
		END = UPPER(:COUNTRY)
		AND C.ENTRY_TYPE = 'CM'
		AND CLAIM_NUMBER LIKE 'C%'
	ORDER BY
		ACCOUNT;
	
select * from R12_ACCOUNT_FILTER_UPD where like_5 = 'Y';	
-- 50677971, 50689611	
select customer_trx_id, invoice from R12_BI_ACCT_ENTRY_STG where invoice = '50005758';

-- 50689611
select * from R12_BI_ACCT_ENTRY_STG_T where invoice = 50005758 and customer_trx_id = 50689611;
select * from R12_BI_HDR_STG_T where invoice = 50005758;
select * from R12_BI_LINE_STG_T where invoice = 50005758;
select * from R12_BI_HDR_STG_T where invoice = 50005758;

select * from R12_BI_ACCT_ENTRY_STG where invoice = 50005758;

select * from R12_BI_ACCT_ENTRY_STG where invoice = '50005758' and customer_trx_id = 50689611;
select * from R12_BI_HDR_STG where invoice = '50005758' and customer_trx_id = 50689611;
select * from R12_BI_LINE_STG where invoice = '50005758';



select * from R12_BI_HDR_STG where customer_trx_id = 50677971;

	SELECT DISTINCT
		C.Bill_Source_Id,
		C.Entry_Type,
		count(*),
		count(distinct a.invoice) numInvoice,
		count(distinct a.claim_number) numClaims,
		sum(case when afu.like_5 = 'Y' then 1 else 0 end) numExtendedWarrClaims
	FROM
		R12_BI_ACCT_ENTRY_STG A
	INNER JOIN R12_TRNBI_BI_HDR_STG B     ON A.INVOICE = B.INVOICE AND A.CUSTOMER_TRX_ID = B.CUSTOMER_TRX_ID
	INNER JOIN R12_BI_HDR_STG C           ON B.INVOICE = C.INVOICE AND B.CUSTOMER_TRX_ID = C.CUSTOMER_TRX_ID
	INNER JOIN R12_ACCOUNT_FILTER_UPD AFU ON AFU.R12_ACCOUNT = A.R12_ACCOUNT
	GROUP BY
		C.Bill_Source_Id,
		C.Entry_Type
	order by 1,2
;
	select C.Bill_Source_Id,
		C.Entry_Type,a.*
	FROM
		R12_BI_ACCT_ENTRY_STG A
	INNER JOIN R12_TRNBI_BI_HDR_STG B     ON A.INVOICE = B.INVOICE AND A.CUSTOMER_TRX_ID = B.CUSTOMER_TRX_ID
	INNER JOIN R12_BI_HDR_STG C           ON B.INVOICE = C.INVOICE AND B.CUSTOMER_TRX_ID = C.CUSTOMER_TRX_ID
	where c.bill_source_id like 'HVAC%'
	and c.entry_type = 'INV'
	and substr(claim_number,1,10) in ('C-20000124','C-20000138','C-20000165','C-20000304','C-20000402','C-20000562','C-20000578','C-20000920','C-20000921','C-20000856');
